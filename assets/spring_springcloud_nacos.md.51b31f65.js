import{_ as s,c as a,o as n,a as l}from"./app.9e1597b0.js";const u=JSON.parse('{"title":"Nacos","description":"","frontmatter":{},"headers":[{"level":2,"title":"注册中心","slug":"注册中心","link":"#注册中心","children":[]},{"level":2,"title":"配置中心","slug":"配置中心","link":"#配置中心","children":[{"level":3,"title":"基本使用","slug":"基本使用","link":"#基本使用","children":[]},{"level":3,"title":"profile粒度配置","slug":"profile粒度配置","link":"#profile粒度配置","children":[]},{"level":3,"title":"优先级","slug":"优先级","link":"#优先级","children":[]},{"level":3,"title":"动态更新","slug":"动态更新","link":"#动态更新","children":[]}]}],"relativePath":"spring/springcloud/nacos.md","lastUpdated":1673527374000}'),p={name:"spring/springcloud/nacos.md"},e=l(`<h1 id="nacos" tabindex="-1">Nacos <a class="header-anchor" href="#nacos" aria-hidden="true">#</a></h1><h2 id="注册中心" tabindex="-1">注册中心 <a class="header-anchor" href="#注册中心" aria-hidden="true">#</a></h2><p><a href="https://nacos.io/zh-cn/docs/quick-start.html" target="_blank" rel="noreferrer">nacos 快速开始</a></p><p><a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html" target="_blank" rel="noreferrer">nacos spring cloud 快速开始</a></p><ol><li>引入依赖</li></ol><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark"><code><span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">dependency</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">   &lt;</span><span style="color:#7EE787;">groupId</span><span style="color:#C9D1D9;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#7EE787;">groupId</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">   &lt;</span><span style="color:#7EE787;">artifactId</span><span style="color:#C9D1D9;">&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/</span><span style="color:#7EE787;">artifactId</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;/</span><span style="color:#7EE787;">dependency</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>项目配置</li></ol><p>application.yaml</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark"><code><span class="line"><span style="color:#7EE787;">server</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">port</span><span style="color:#C9D1D9;">: </span><span style="color:#79C0FF;">8080</span></span>
<span class="line"><span style="color:#7EE787;">spring</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">application</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nacos-provider</span></span>
<span class="line"><span style="color:#7EE787;">spring</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">cloud</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">nacos</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">discovery:server-addr</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">127.0.0.1:8848</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="配置中心" tabindex="-1">配置中心 <a class="header-anchor" href="#配置中心" aria-hidden="true">#</a></h2><h3 id="基本使用" tabindex="-1">基本使用 <a class="header-anchor" href="#基本使用" aria-hidden="true">#</a></h3><p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/2022.x/spring-cloud-alibaba-docs/src/main/asciidoc-zh/nacos-config.adoc" target="_blank" rel="noreferrer">中文文档</a></p><ol><li>引入依赖</li></ol><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark"><code><span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">dependency</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">    &lt;</span><span style="color:#7EE787;">groupId</span><span style="color:#C9D1D9;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#7EE787;">groupId</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">    &lt;</span><span style="color:#7EE787;">artifactId</span><span style="color:#C9D1D9;">&gt;spring-cloud-starter-alibaba-nacos-config&lt;/</span><span style="color:#7EE787;">artifactId</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;/</span><span style="color:#7EE787;">dependency</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>创建配置 下图表示 DataId 使用 <code>order-service</code>, GROUP 使用 <code>DEFAULT_GROUP</code>，配置格式为 <code>yaml</code> 的一个配置项: <img src="https://cdn.azhiyuan.com.cn/markdown/img/2023/01/12/20230112201344.png" alt="配置详情"></li></ol><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>在<code>springboot 2.5.x</code>以上版本,默认禁用了<code>bootstrap</code>模块</p><p>所以需要重新引入 <code>org.springframework.cloud:spring-cloud-starter-bootstrap</code> 模块</p></div><p>bootstrap.yaml</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark"><code><span class="line"><span style="color:#7EE787;">spring</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">application</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">order-service</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">profiles</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#  当前环境配置</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">active</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">dev</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">cloud</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">nacos</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">config</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#7EE787;">server-addr</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">127.0.0.1:8848</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># 配置后缀名</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#7EE787;">file-extension</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">yaml</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="profile粒度配置" tabindex="-1">profile粒度配置 <a class="header-anchor" href="#profile粒度配置" aria-hidden="true">#</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Nacos Config 在加载配置的时候，不仅仅加载了以 DataId 为 \${<a href="http://spring.application.name" target="_blank" rel="noreferrer">spring.application.name</a>}.\${file-extension:yaml} 为前缀的基础配置，还加载了DataId为 \${<a href="http://spring.application.name" target="_blank" rel="noreferrer">spring.application.name</a>}-\${profile}.\${file-extension:yaml} 的基础配置。在日常开发中如果遇到多套环境下的不同配置，可以通过Spring 提供的 \${spring.profiles.active} 这个配置项来配置。</p></div><p><code>spring.profiles.active=develop</code> 此时会匹配 <code>\${spring.application.name}-develop.yaml</code> 的配置文件</p><h3 id="优先级" tabindex="-1">优先级 <a class="header-anchor" href="#优先级" aria-hidden="true">#</a></h3><blockquote><p>优先级：bootstrap优先执行，application在bootstrap加载后再执行</p></blockquote><p>bootstrap会在加载配置中心前执行,预先加载配置中心配置</p><p>Nacos Config 目前提供了三种配置能力从 Nacos 拉取相关的配置</p><ul><li><p>A: 通过 spring.cloud.nacos.config.shared-dataids 支持多个共享 Data Id 的配置</p></li><li><p>B: 通过 spring.cloud.nacos.config.ext-config[n].data-id 的方式支持多个扩展 Data Id 的配置</p></li><li><p>C: 通过内部相关规则(应用名、应用名+ Profile )自动生成相关的 Data Id 配置</p></li></ul><p>当三种方式共同使用时，他们的一个优先级关系是: A &lt; B &lt; C</p><h3 id="动态更新" tabindex="-1">动态更新 <a class="header-anchor" href="#动态更新" aria-hidden="true">#</a></h3><blockquote><p>Nacos Config 默认支持配置的动态更新</p><p>可以通过配置 <code>spring.cloud.nacos.config.refresh.enabled=false</code> 来关闭动态刷新</p></blockquote>`,29),o=[e];function r(c,t,i,d,D,b){return n(),a("div",null,o)}const g=s(p,[["render",r]]);export{u as __pageData,g as default};
